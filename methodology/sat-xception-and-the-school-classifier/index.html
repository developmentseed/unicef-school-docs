<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="description" content="AI-assisted school mapping" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

<title>Project Connect</title>

<!-- Twitter -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="" />
<meta name="twitter:title" content="Project Connect">
<meta name="twitter:description" content="AI-assisted school mapping" />
<meta name="twitter:image:src" content="http://devseed.com/unicef-school-docs/assets/graphics/meta/default-meta-image.png" />
<!--/ Twitter -->

<!-- OG -->
<meta property="og:site_name" content="Project Connect" />
<meta property="og:title" content="Project Connect" />
<meta property="og:url" content="" />
<meta property="og:type" content="website" />
<meta property="og:description" content="AI-assisted school mapping" />
<meta property="og:image" content="http://devseed.com/unicef-school-docs/assets/graphics/meta/default-meta-image.png" />
<!--/ OG -->

<link rel="icon" type="image/png" sizes="96x96" href="http://devseed.com/unicef-school-docs/assets/graphics/meta/favicon.png" />
<link rel="icon" type="image/png" sizes="192x192" href="http://devseed.com/unicef-school-docs/assets/graphics/meta/android-chrome.png" />
<link rel="apple-touch-icon" sizes="180x180" href="http://devseed.com/unicef-school-docs/assets/graphics/meta/apple-touch-icon.png" />


<link rel="author" type="text/plain" href="humans.txt" />

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i" />



<link rel="stylesheet" href="http://devseed.com/unicef-school-docs/assets/styles/main-e2f7d91a02.css">

  </head>
  <body>
    <!-- page -->
    <div class="page">

      <header class="page__header" role="banner">
        <div class="inner">
          <div class="page__headline">
            <a href="/" title="Visit homepage">
              <h1 class="page__title">Project Connect</h1>
              <p class="page__subtitle">AI-assisted school mapping</p>
            </a>
          </div>
          <div class="page__browser pb" data-hook="menu:wrapper">
            <h2 class="pb__title"><a href="#ppn__contents" title="Show/hide" class="pb__toggle" data-hook="menu:toggle"><span>Navigation & Colophon</span></a></h2>
            <div id="pb__contents" class="pb__contents">
              <div class="inner">
                <nav class="page__prime-nav ppn">
  
  

  
  <section class="ppn__section">
    <h3 class="ppn__section-title">Introduction</h3>
    




<ul class="ppn__menu">
  
  <li>
      
      <a href="http://devseed.com/unicef-school-docs/" title="Go to page" class="ppn__menu-item ">Executive Summary</a>
      





  </li>
  
</ul>


  </section>
  
  <section class="ppn__section">
    <h3 class="ppn__section-title">Methodology</h3>
    




<ul class="ppn__menu">
  
  <li>
      
      <a href="http://devseed.com/unicef-school-docs/methodology/methodology" title="Go to page" class="ppn__menu-item ">Methodology</a>
      




<ul class="ppn__menu">
  
  <li>
      
      <a href="http://devseed.com/unicef-school-docs/methodology/school-data-cleaning" title="Go to page" class="ppn__menu-item ">School data cleaning</a>
      





  </li>
  
  <li>
      
      <a href="http://devseed.com/unicef-school-docs/methodology/training-dataset-creation" title="Go to page" class="ppn__menu-item ">Training dataset creation</a>
      





  </li>
  
  <li>
      
      <a href="http://devseed.com/unicef-school-docs/methodology/sat-xception-and-the-school-classifier" title="Go to page" class="ppn__menu-item ppn__menu-item--active">Sat-Xception and the school classifier</a>
      





  </li>
  
  <li>
      
      <a href="http://devseed.com/unicef-school-docs/methodology/the-large-scale-model-inference" title="Go to page" class="ppn__menu-item ">The large scale model inference</a>
      





  </li>
  
  <li>
      
      <a href="http://devseed.com/unicef-school-docs/methodology/ml-prediction-validation" title="Go to page" class="ppn__menu-item ">ML prediction validation</a>
      





  </li>
  
</ul>


  </li>
  
</ul>


  </section>
  
  <section class="ppn__section">
    <h3 class="ppn__section-title">Results</h3>
    




<ul class="ppn__menu">
  
  <li>
      
      <a href="http://devseed.com/unicef-school-docs/results/results-and-discussion" title="Go to page" class="ppn__menu-item ">Results and Discussion</a>
      




<ul class="ppn__menu">
  
  <li>
      
      <a href="http://devseed.com/unicef-school-docs/results/overall-model-performance" title="Go to page" class="ppn__menu-item ">Overall model performance</a>
      





  </li>
  
  <li>
      
      <a href="http://devseed.com/unicef-school-docs/results/ai-assisted-school-mapping-and-discussion" title="Go to page" class="ppn__menu-item ">AI assisted school mapping and discussion</a>
      





  </li>
  
  <li>
      
      <a href="http://devseed.com/unicef-school-docs/results/future-work" title="Go to page" class="ppn__menu-item ">Future work</a>
      





  </li>
  
</ul>


  </li>
  
</ul>


  </section>
  
  <section class="ppn__section">
    <h3 class="ppn__section-title">Conclusion</h3>
    




<ul class="ppn__menu">
  
  <li>
      
      <a href="http://devseed.com/unicef-school-docs/conclusion/conclusion" title="Go to page" class="ppn__menu-item ">Conclusion</a>
      





  </li>
  
</ul>


  </section>
  
</nav>

              </div>
            </div>
          </div>
        </div>
      </header>

      <main class="page__body" role="main">
        <div class="inner">

          
          <!-- attribution -->
          <address class="page__attribution pa">
            <div class="pa__label">
              <small>Developed for</small>
              <a href="https://www.unicef.org/innovation/school-mapping" title="Visit">
                <strong>UNICEF</strong>
              </a>
            </div>
            
            <div class="pa__logo">
              <a href="https://www.unicef.org/innovation/school-mapping" title="Visit">
                <img alt="UNICEF logo" src="http://devseed.com/unicef-school-docs/assets/graphics/content/Unicef_logo_blue.png" />
              </a>
            </div>
            
          </address>
          <!--/ attribution -->
          

          <!-- inpage -->
          <article class="inpage">
            <header class="inpage__header">
              <div class="inner">

                <div class="inpage__headline">
                  <p class="inpage__subtitle">Methodology</p>
                  <h1 class="inpage__title">Sat-Xception and the school classifier</h1>
                </div>

              </div>
            </header>

            <div class="inpage__body">
              <div class="inner">
                <div class="prose prose--responsive">
                  <h4>Selecting a machine learning framework</h4>
<p>We did initial testing on two promising ML frameworks: Xception and MobileNetV2, two pre-trained models built in our <code>Sat-Xception</code>. Our preliminary testing showed slightly better results from Xception, so we selected Xception for the remainder of the project. However, MobileNetV2 only used a quarter of time per training iteration on exactly the same training set. <strong>For those without access to rich cloud computing resources, you might consider using MobileNetV2 to train the model instead.</strong></p>
<h4>Sat-Xception</h4>
<p>To quickly train the school classifier, we create a deep learning python package called <code>Sat-Xception</code>. It is a deep learning package that utilizes pre-trained models from <a href="https://en.wikipedia.org/wiki/ImageNet">ImageNet</a>. <strong>It currently private and we will make it open sourced soon</strong>. <a href="https://arxiv.org/abs/1610.02357">Xception</a> and <a href="http://keras.io/applications/">MobileNetV2</a> were two pre-trained models built-in in the package. The package is designed to quickly install, transfer-learn and fine-tune image classifiers with the built-in pre-trained models, which can be used to train other classifiers rather than just school classifier in this case. They were written by <a href="http://keras.io/">Keras</a>, a high-level python package that can allow users to quickly reconstruct neural networks Google's <a href="https://www.tensorflow.org">Tensorflow</a> was used as backend.</p>
<figure class="align-center">
<img src="http://devseed.com/unicef-school-docs/assets/graphics/content/methodology/DCNNs.jpeg" alt="Put unmapped schools on the map with machine learning" />
<figcaption> Xception and MobileNetV2 are both high-performed pretrained models</figcaption>
</figure>
<p>Xception is one of current state-of-the-art CNN architectures and pre-trained models on top of <a href="http://www.image-net.org/">ImageNet</a>.  It’s a high performing and efficient network compared to other <a href="http://keras.io/applications/">pre-trained networks</a>. <a href="https://arxiv.org/abs/1801.04381">MobileNetV2</a> on the other hand, is a model that is slightly less accurate compared to Xception. However, it's a very light-weight, fast, and easy to tune when limited resources available (appropriate for scenarios with resource vs. accuracy tradeoff). Both Xception and MobileNetV2 have fewer hyper-parameter available to tune compared to other pre-trained models, e.g. VGG and Inception, but both are high-performed models.</p>
<h4>Training a school classifier with <code>sat-xception</code></h4>
<p>To install <code>sat-xception</code> , transfer-learn and fine tune an image classification model, you need to:</p>
<ul>
<li>
<p>set up an python environment using <a href="https://uoa-eresearch.github.io/eresearch-cookbook/recipe/2014/11/20/conda/">conda to create a virtual environment</a> or use <a href="https://gist.github.com/Geoyi/f55ed54d24cc9ff1c14bd95fac21c042">pyenv</a>;</p>
</li>
<li>
<p>git clone <a href="https://github.com/developmentseed/unicef-schools.git">this repo</a> (will open source soon);</p>
</li>
<li>
<p>cd to main_model where the <code>sat-xception</code> core script is located;</p>
</li>
<li>
<p>run <code>pip3 install -e .</code> or <code>pip install -e .</code></p>
</li>
</ul>
<p>We organize the training dataset in such a order:</p>
<pre><code>└── main_model/
    ├── train/
           ├── not-school
           ├── school
    └── valid/
           ├── not-school
           ├── school
    └── test/
           ├── not-school
           ├── school
</code></pre>
<p>To train a school classifier, or any other image classification, you only need to install the <code>Sat_Xception</code> and run <code>train</code> with the selected models. For instance, to train a school classifier with MobileNetV2 you can run:</p>
<pre><code bash="">sat_xception train -model=mobilenetv2 -train=train -valid=valid
</code></pre>
<h4>School classifier and model performance</h4>
<p>We broke the training sessions into two sessions. The first session was designed to test the feasibility of using Sat-Xception to train a well-performed school classifier in Colombia. The model was over-confident in rural Colombia in the first session, leading to too many false predictions in the area. To overcome the issue, the expert mapper team created a new training dataset that was slightly different from the training dataset in the first session. In the second training session, 2,048 ‘not-school’ buildings were added. In addition, for the “school” category, we only kept rural schools that have very clear school features. We also randomly selected another 2,500 confirmed school tiles to add to the category.</p>
<p>We trained about 200 model iterations on two separate <a href="https://aws.amazon.com/ec2">AWS EC2</a>  <a href="https://aws.amazon.com/ec2/instance-types/p3/">P3.2xlarge</a>. They are AWS’s deep learning AMI machines that have deep learning virtual environment setup, e.g. python3 with Tensorflow GPU version pre-installed in our case, and ready-to-use.  We found the best-performing model from MobileNetV2 with a validation accuracy of 0.88. However, Xception reached a validation accuracy of 0.89, and therefore, we picked the model trained with Xception. We packaged the best-trained Xception model with Tensorflow Serving. <a href="https://www.tensorflow.org/tfx/guide/serving">Tensorflow Serving</a> helps to package the Keras and Tensorflow model as a <a href="https://docs.docker.com/v17.09/engine/userguide/storagedriver/imagesandcontainers/">a Docker image</a>. The image can serve as an endpoint for large spatial scale model inference, which allows us to run model inference on tens of millions of image tiles per hour without manually watching the inference.</p>
<figure class="align-center">
<img src="http://devseed.com/unicef-school-docs/assets/graphics/content/methodology/val_acc_loss_cv4gc.png" alt="ML accuracy" />
<figcaption> The validation accuracy and loss from model training iterations. Model training iteration with Xception at the first row and MobileNetV2 at the second row. The two models were trained on the same dataset, and the following graph only reflected the training with the 2nd session of the training dataset.</figcaption>
</figure>

                </div>
              </div>
            </div>

            <footer class="inpage__footer">
              <div class="inner">
                <nav class="inpage__actions">
                  <ul>
                    <li>
                      
                        <a href="http://devseed.com/unicef-school-docs/methodology/training-dataset-creation" class="pa-prev" title="View previous post"><span>Prev</span></a>
                      
                    </li>
                    <li>
                      
                        <a href="http://devseed.com/unicef-school-docs/methodology/the-large-scale-model-inference" class="pa-next" title="View next post"><span>Next</span></a>
                      
                    </li>
                  </ul>
                </nav>
              </div>
            </footer>
          </article>
          <!--/ inpage -->

        </div>
      </main>

      <footer class="page__footer" role="contentinfo">
        <div class="inner">
          <p>
            <a href="https://developmentseed.org" title="Visit Development Seed website">
              <span><img src="http://devseed.com/unicef-school-docs/assets/graphics/layout/devseed-logo-symbol.svg" alt="Development Seed logo symbol" width="512" height="152" /></span>
              <strong>Development Seed</strong>
              <small>2019</small>
            </a>
          </p>
        </div>
      </footer>

    </div>
    <!--/ page -->

    <script src="http://devseed.com/unicef-school-docs/assets/scripts/vendor-2fa80a543b.js"></script>

<script src="http://devseed.com/unicef-school-docs/assets/scripts/bundle-7df0b6512d.js"></script>
  </body>
</html>
